<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plano Alimentar Personalizado - VittaWay</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* --- 1. Reset e Variáveis Globais --- */
        :root {
            --green-dark: #256A3F;
            --green-medium: #2E7D32;
            --green-light: #60AD5E;
            --white: #FFFFFF;
            --gray-soft: #f4f6f8;
            --gray-medium: #e0e0e0;
            --gray-dark: #333333;
            --error-color: #d32f2f;

            --font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            --border-radius: 8px;
            --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --transition-speed: 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--gray-soft);
            color: var(--gray-dark);
            line-height: 1.6;
        }

        /* --- 2. Layout Principal e Header --- */
        .container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
        }

        .header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .header__logo {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--green-dark);
            letter-spacing: -1px;
        }

        .header__logo span {
            color: var(--green-light);
        }

        .header__subtitle {
            font-size: 1.25rem;
            color: var(--green-medium);
            margin-top: 0.25rem;
        }

        .header__description {
            max-width: 600px;
            margin: 1rem auto 0;
            color: #555;
        }
        
        /* --- 3. Estilos do Formulário (Cartão) --- */
        .vittaway-form {
            background: var(--white);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        fieldset {
            border: none;
            border-top: 1px solid var(--gray-medium);
            padding-top: 2rem;
            margin-top: 2rem;
        }

        legend {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--green-dark);
            margin-bottom: 1.5rem;
            padding: 0 0.5rem;
            margin-left: -0.5rem;
        }

        /* --- 4. Grupos de Campos e Inputs --- */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #444;
        }

        .form-group label .required-star {
            color: var(--error-color);
        }

        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="number"],
        .form-group input[type="time"],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--gray-medium);
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-family: var(--font-family);
            transition: border-color var(--transition-speed), box-shadow var(--transition-speed);
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--green-medium);
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.2);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .input-error-message {
            color: var(--error-color);
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none; /* Oculto por padrão */
        }
        
        .form-group.error input,
        .form-group.error select,
        .form-group.error textarea {
             border-color: var(--error-color);
        }
        
        .form-group.error .input-error-message {
            display: block;
        }

        /* --- 5. Opções (Radio, Checkbox, Slider) --- */
        .options-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .options-group label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            font-weight: 400;
        }

        .options-group input[type="radio"],
        .options-group input[type="checkbox"] {
            width: 1em;
            height: 1em;
            accent-color: var(--green-medium);
        }

        /* Slider de Estresse */
        .slider-group {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        #estresse-valor {
            font-weight: bold;
            color: var(--green-medium);
            min-width: 20px;
        }
        
        /* --- 6. Botão de Envio --- */
        .submit-btn {
            width: 100%;
            padding: 1rem;
            background-color: var(--green-medium);
            color: var(--white);
            border: none;
            border-radius: var(--border-radius);
            font-size: 1.125rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color var(--transition-speed), transform var(--transition-speed);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .submit-btn:hover:not(:disabled) {
            background-color: var(--green-dark);
            transform: translateY(-2px);
        }

        .submit-btn:disabled {
            background-color: var(--green-light);
            cursor: not-allowed;
            opacity: 0.8;
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: var(--white);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: none; /* Oculto por padrão */
        }

        .submit-btn.loading .spinner {
            display: block;
        }
        .submit-btn.loading .btn-text {
            margin-left: 0.5rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* --- 7. Modal e Toast de Sucesso --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-speed), visibility var(--transition-speed);
            z-index: 1000;
        }
        
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: var(--white);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            text-align: center;
            max-width: 500px;
            transform: scale(0.9);
            transition: transform var(--transition-speed);
        }
        
        .modal-overlay.visible .modal-content {
            transform: scale(1);
        }

        .modal-content h2 {
            color: var(--green-dark);
            margin-bottom: 1rem;
        }

        .modal-content p {
            margin-bottom: 1.5rem;
        }

        .modal-close-btn {
            padding: 0.75rem 1.5rem;
            background: var(--green-medium);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color var(--transition-speed);
        }
        .modal-close-btn:hover {
            background: var(--green-dark);
        }

        /* --- 8. Acessibilidade e Utilitários --- */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* --- 9. Responsividade (Mobile-first) --- */
        @media (max-width: 768px) {
            .container {
                padding: 1.5rem 1rem;
            }
            .vittaway-form {
                padding: 1.5rem;
            }
            legend {
                font-size: 1.25rem;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <header class="header">
            <h1 class="header__logo">Vitta<span>Way</span></h1>
            <p class="header__subtitle">Seu caminho para uma vida mais saudável.</p>
            <p class="header__description">
                Preencha o formulário abaixo com atenção. Suas respostas são a base para criarmos um plano alimentar 100% personalizado e eficaz para você.
            </p>
        </header>

        <main>
            <form id="vittaway-form" class="vittaway-form" novalidate>
                
                <fieldset>
                    <legend>1. Dados Pessoais</legend>
                    <div class="form-group">
                        <label for="nome">Nome Completo <span class="required-star">*</span></label>
                        <input type="text" id="nome" name="nome" required>
                        <div class="input-error-message">Por favor, insira seu nome.</div>
                    </div>
                    <div class="form-group">
                        <label for="email">E-mail <span class="required-star">*</span></label>
                        <input type="email" id="email" name="email" placeholder="seu.email@exemplo.com" required>
                        <div class="input-error-message">Por favor, insira um e-mail válido.</div>
                    </div>
                    <div class="form-group">
                        <label for="idade">Idade <span class="required-star">*</span></label>
                        <input type="number" id="idade" name="idade" min="12" max="120" required>
                        <div class="input-error-message">Por favor, insira uma idade válida.</div>
                    </div>
                    <div class="form-group">
                        <label>Sexo <span class="required-star">*</span></label>
                        <div class="options-group">
                            <label><input type="radio" name="sexo" value="masculino" required> Masculino</label>
                            <label><input type="radio" name="sexo" value="feminino"> Feminino</label>
                            <label><input type="radio" name="sexo" value="outro"> Outro</label>
                        </div>
                        <div class="input-error-message">Por favor, selecione uma opção.</div>
                    </div>
                </fieldset>
                
                <fieldset>
                    <legend>2. Medidas Corporais</legend>
                    <div class="form-group">
                        <label for="altura">Altura (cm) <span class="required-star">*</span></label>
                        <input type="number" id="altura" name="altura" placeholder="Ex: 175" required>
                        <div class="input-error-message">Insira sua altura em centímetros.</div>
                    </div>
                    <div class="form-group">
                        <label for="peso">Peso (kg) <span class="required-star">*</span></label>
                        <input type="number" id="peso" name="peso" step="0.1" placeholder="Ex: 68.5" required>
                        <div class="input-error-message">Insira seu peso em quilogramas.</div>
                    </div>
                    <div class="form-group"><label for="cintura">Cintura (cm)</label><input type="number" id="cintura" name="cintura" placeholder="Medida na altura do umbigo"></div>
                    <div class="form-group"><label for="quadril">Quadril (cm)</label><input type="number" id="quadril" name="quadril" placeholder="Medida na parte mais larga"></div>
                    <div class="form-group"><label for="busto">Busto/Tórax (cm)</label><input type="number" id="busto" name="busto" placeholder="Medida na altura do mamilo"></div>
                    <div class="form-group"><label for="braco">Braço (cm)</label><input type="number" id="braco" name="braco" placeholder="Braço relaxado"></div>
                    <div class="form-group"><label for="coxa">Coxa (cm)</label><input type="number" id="coxa" name="coxa" placeholder="Parte mais larga da coxa (meio)"></div>
                </fieldset>
                
                <fieldset>
                    <legend>3. Seus Objetivos</legend>
                    <div class="form-group">
                        <label>Qual seu principal objetivo? <span class="required-star">*</span></label>
                        <div class="options-group">
                            <label><input type="radio" name="objetivo" value="emagrecer" required> Emagrecer</label>
                            <label><input type="radio" name="objetivo" value="ganhar-massa"> Ganhar Massa Muscular</label>
                            <label><input type="radio" name="objetivo" value="manter-peso"> Manter o Peso</label>
                            <label><input type="radio" name="objetivo" value="melhorar-saude"> Melhorar Saúde/Disposição</label>
                        </div>
                        <div class="input-error-message">Por favor, selecione um objetivo.</div>
                    </div>
                    <div class="form-group">
                        <label for="tempoObjetivo">Em quanto tempo (meses) você gostaria de atingir seu objetivo?</label>
                        <input type="number" id="tempoObjetivo" name="tempoObjetivo" min="1" placeholder="Ex: 3">
                    </div>
                    <div class="form-group">
                        <label>Qual sua prioridade?</label>
                        <div class="options-group">
                            <label><input type="radio" name="prioridade" value="rapido"> Resultados rápidos</label>
                            <label><input type="radio" name="prioridade" value="sustentavel"> Processo sustentável</label>
                            <label><input type="radio" name="prioridade" value="equilibrio" checked> Equilíbrio entre os dois</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Você já seguiu alguma dieta antes?</label>
                        <div class="options-group">
                            <label><input type="radio" name="jaSeguiuDieta" value="sim"> Sim</label>
                            <label><input type="radio" name="jaSeguiuDieta" value="nao" checked> Não</label>
                        </div>
                    </div>
                    <div class="form-group hidden" id="dieta-anterior-container">
                        <label for="dietaAnteriorExperiencia">Como foi sua experiência? (O que funcionou e o que não funcionou?)</label>
                        <textarea id="dietaAnteriorExperiencia" name="dietaAnteriorExperiencia" placeholder="Ex: Tentei a dieta X, perdi peso rápido mas não consegui manter..."></textarea>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>4. Saúde e Restrições</legend>
                    <div class="form-group">
                        <label for="alergias">Você possui alguma alergia alimentar?</label>
                        <input type="text" id="alergias" name="alergias" placeholder="Ex: Glúten, lactose, amendoim, frutos do mar">
                    </div>
                    <div class="form-group">
                        <label for="restricoes">Algum alimento que você não come por motivos não alérgicos? (Ex: veganismo, religião)</label>
                        <input type="text" id="restricoes" name="restricoes" placeholder="Ex: Não como carne vermelha">
                    </div>
                    <div class="form-group">
                        <label for="preferenciasAlimentares">Descreva suas preferências alimentares em geral.</label>
                        <textarea id="preferenciasAlimentares" name="preferenciasAlimentares" placeholder="Ex: Gosto de comidas mais leves, prefiro frango e peixe, adoro saladas..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Você possui algum problema de saúde? (Marque todos que se aplicam)</label>
                        <div class="options-group">
                            <label><input type="checkbox" name="problemasSaude" value="diabetes"> Diabetes</label>
                            <label><input type="checkbox" name="problemasSaude" value="hipertensao"> Hipertensão</label>
                            <label><input type="checkbox" name="problemasSaude" value="colesterol"> Colesterol Alto</label>
                            <label><input type="checkbox" name="problemasSaude" value="tireoide"> Problemas na Tireoide</label>
                            <label><input type="checkbox" name="problemasSaude" value="gastrico"> Problemas Gástricos</label>
                            <label><input type="checkbox" name="problemasSaude" value="outro"> Outro(s)</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="medicamentos">Você usa algum medicamento contínuo? Se sim, qual?</label>
                        <textarea id="medicamentos" name="medicamentos" placeholder="Liste os medicamentos e, se souber, a dosagem"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Você tem ou já teve algum distúrbio alimentar?</label>
                        <div class="options-group">
                            <label><input type="radio" name="disturbioAlimentar" value="sim"> Sim</label>
                            <label><input type="radio" name="disturbioAlimentar" value="nao" checked> Não</label>
                             <label><input type="radio" name="disturbioAlimentar" value="prefiro-nao-dizer"> Prefiro não dizer</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="estresse">Em uma escala de 0 a 5, qual seu nível de estresse atualmente?</label>
                        <div class="slider-group">
                            <span>0</span>
                            <input type="range" id="estresse" name="estresse" min="0" max="5" value="2" style="width: 100%;">
                            <span>5</span>
                            <span id="estresse-valor">2</span>
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>5. Seus Hábitos</legend>
                    <div class="form-group">
                        <label for="refeicoes">Quantas grandes refeições você faz por dia? (Café, Almoço, Jantar)</label>
                        <select id="refeicoes" name="refeicoes">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3" selected>3</option>
                            <option value="4+">4 ou mais</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Você costuma fazer lanches entre as refeições?</label>
                        <div class="options-group">
                            <label><input type="radio" name="lanches" value="sim" checked> Sim</label>
                            <label><input type="radio" name="lanches" value="nao"> Não</label>
                            <label><input type="radio" name="lanches" value="as-vezes"> Às vezes</label>
                        </div>
                    </div>
                    <div class="form-group"><label for="acordar">Que horas você costuma acordar?</label><input type="time" id="acordar" name="acordar"></div>
                    <div class="form-group"><label for="dormir">Que horas você costuma dormir?</label><input type="time" id="dormir" name="dormir"></div>
                    <div class="form-group">
                        <label for="gostaComer">Quais alimentos você mais gosta de comer?</label>
                        <textarea id="gostaComer" name="gostaComer" placeholder="Liste seus alimentos favoritos."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="naoGosta">Quais alimentos você NÃO gosta de jeito nenhum?</label>
                        <textarea id="naoGosta" name="naoGosta" placeholder="Liste os alimentos que devemos evitar no seu plano."></textarea>
                    </div>
                    <div class="form-group"><label>Com que frequência você come doces?</label><div class="options-group"><label><input type="radio" name="doces" value="diariamente"> Diariamente</label><label><input type="radio" name="doces" value="semanalmente" checked> Semanalmente</label><label><input type="radio" name="doces" value="raramente"> Raramente</label></div></div>
                    <div class="form-group"><label>Com que frequência você consome bebidas alcoólicas?</label><div class="options-group"><label><input type="radio" name="alcool" value="nao-consumo" checked> Não consumo</label><label><input type="radio" name="alcool" value="socialmente"> Socialmente</label><label><input type="radio" name="alcool" value="frequentemente"> Frequentemente</label></div></div>
                    <div class="form-group"><label>Qual sua ingestão de água diária?</label><div class="options-group"><label><input type="radio" name="agua" value="baixa"> Baixa (menos de 1L)</label><label><input type="radio" name="agua" value="media" checked> Média (1-2L)</label><label><input type="radio" name="agua" value="alta"> Alta (mais de 2L)</label></div></div>
                    <div class="form-group"><label for="localRefeicoes">Onde você costuma fazer suas principais refeições?</label><select id="localRefeicoes" name="localRefeicoes"><option value="casa" selected>Em casa</option><option value="trabalho">No trabalho (levo marmita)</option><option value="restaurante">Restaurante/Buffet</option><option value="variado">Varia muito</option></select></div>
                    <div class="form-group"><label for="preparoRef">Quem prepara suas refeições?</label><select id="preparoRef" name="preparoRef"><option value="eu-mesmo" selected>Eu mesmo(a)</option><option value="outra-pessoa">Outra pessoa</option><option value="delivery">Peço delivery/compro pronto</option></select></div>
                </fieldset>

                <fieldset>
                    <legend>6. Atividade Física</legend>
                    <div class="form-group">
                        <label>Você pratica exercícios físicos regularmente?</label>
                        <div class="options-group">
                            <label><input type="radio" name="praticaExercicio" value="sim"> Sim</label>
                            <label><input type="radio" name="praticaExercicio" value="nao" checked> Não</label>
                        </div>
                    </div>
                    <div class="form-group hidden" id="tipo-exercicio-container">
                        <label for="tipoExercicio">Quais exercícios/atividades você pratica e com que frequência?</label>
                        <textarea id="tipoExercicio" name="tipoExercicio" placeholder="Ex: Musculação 3x por semana, corrida 2x..."></textarea>
                    </div>
                    <div class="form-group"><label>Seu nível de atividade diária (fora exercícios):</label><div class="options-group"><label><input type="radio" name="nivelAtividade" value="sedentario" checked> Sedentário (maior parte sentado)</label><label><input type="radio" name="nivelAtividade" value="leve"> Leve (caminhadas leves)</label><label><input type="radio" name="nivelAtividade" value="ativo"> Ativo (trabalho em pé, etc)</label></div></div>
                    <div class="form-group"><label for="trabalho">Como é o seu trabalho?</label><select id="trabalho" name="trabalho"><option value="escritorio" selected>Escritório/Sentado</option><option value="hibrido">Híbrido/Variado</option><option value="ativo-fisicamente">Ativo fisicamente</option><option value="nao-trabalho">Não trabalho/Estudante</option></select></div>
                </fieldset>

                <fieldset>
                    <legend>7. Preferências da Dieta</legend>
                    <div class="form-group">
                        <label>O que você mais valoriza em uma dieta?</label>
                        <div class="options-group">
                            <label><input type="checkbox" name="preferencias" value="tempo-preparo"> Preparo rápido</label>
                            <label><input type="checkbox" name="preferencias" value="custo-baixo"> Custo baixo</label>
                            <label><input type="checkbox" name="preferencias" value="variedade"> Muita variedade</label>
                            <label><input type="checkbox" name="preferencias" value="facilidade-ingredientes"> Ingredientes fáceis de achar</label>
                        </div>
                    </div>
                    <div class="form-group"><label>Que tipo de abordagem você prefere?</label><div class="options-group"><label><input type="radio" name="tipoDieta" value="adaptada" checked> Adaptada à minha rotina atual</label><label><input type="radio" name="tipoDieta" value="radical"> Uma mudança mais radical</dlabel></div></div>
                    <div class="form-group"><label>Como você prefere o cardápio?</label><div class="options-group"><label><input type="radio" name="cardapio" value="fixo"> Fixo (mesmas refeições por alguns dias)</label><label><input type="radio" name="cardapio" value="variado" checked> Variado (uma refeição diferente a cada dia)</label></div></div>
                    <div class="form-group">
                        <label>Quais são seus maiores desafios na alimentação?</label>
                        <div class="options-group">
                            <label><input type="checkbox" name="desafios" value="organizacao"> Falta de tempo/organização</label>
                            <label><input type="checkbox" name="desafios" value="fome-emocional"> Fome emocional/ansiedade</label>
                            <label><input type="checkbox" name="desafios" value="eventos-sociais"> Eventos sociais</label>
                            <label><input type="checkbox" name="desafios" value="vontade-doces"> Vontade de comer doces</label>
                            <label><input type="checkbox" name="desafios" value="disciplina"> Falta de disciplina</label>
                        </div>
                    </div>
                </fieldset>

                <div style="margin-top: 3rem;">
                    <button type="submit" class="submit-btn" id="submit-button">
                        <span class="btn-text">Gerar meu Plano Personalizado</span>
                        <div class="spinner"></div>
                    </button>
                </div>

            </form>
            <div id="form-status" class="sr-only" aria-live="polite"></div>
        </main>
    </div>

    <div class="modal-overlay" id="success-modal">
        <div class="modal-content">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin: 0 auto 1rem;">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="#2E7D32"/>
            </svg>
            <h2>Formulário Enviado!</h2>
            <p>Recebemos suas informações com sucesso. Em breve, seu plano VittaWay estará sendo preparado. Fique de olho no seu e-mail!</p>
            <button class="modal-close-btn" id="close-modal-btn">Fechar</button>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        
        const APP_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx4ufP_A2RbX7EX8KVwfLowOEZfT2kdK2yMPKGFU9lXFHBLHSMMkkeSSf0lBe3UCAZQ_Q/exec';
        // =========================================================================

        const form = document.getElementById('vittaway-form');
        const submitButton = document.getElementById('submit-button');
        const btnText = submitButton.querySelector('.btn-text');
        const spinner = submitButton.querySelector('.spinner');
        const formStatus = document.getElementById('form-status');
        const successModal = document.getElementById('success-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        
        // --- Lógica para campos condicionais ---
        const jaSeguiuDietaRadios = document.querySelectorAll('input[name="jaSeguiuDieta"]');
        const dietaAnteriorContainer = document.getElementById('dieta-anterior-container');
        
        jaSeguiuDietaRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                dietaAnteriorContainer.classList.toggle('hidden', e.target.value !== 'sim');
            });
        });

        const praticaExercicioRadios = document.querySelectorAll('input[name="praticaExercicio"]');
        const tipoExercicioContainer = document.getElementById('tipo-exercicio-container');

        praticaExercicioRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                tipoExercicioContainer.classList.toggle('hidden', e.target.value !== 'sim');
            });
        });
        
        // --- Atualização do valor do slider ---
        const estresseSlider = document.getElementById('estresse');
        const estresseValor = document.getElementById('estresse-valor');
        estresseSlider.addEventListener('input', (e) => {
            estresseValor.textContent = e.target.value;
        });

        // --- Funções de validação ---
        function showError(input, message) {
            const formGroup = input.closest('.form-group');
            const errorDiv = formGroup.querySelector('.input-error-message');
            formGroup.classList.add('error');
            if (errorDiv) {
              errorDiv.textContent = message;
              errorDiv.style.display = 'block';
            }
        }
        
        function clearError(input) {
            const formGroup = input.closest('.form-group');
             if (formGroup) {
               formGroup.classList.remove('error');
               const errorDiv = formGroup.querySelector('.input-error-message');
               if(errorDiv) errorDiv.style.display = 'none';
            }
        }
        
        function validateForm() {
            let isValid = true;
            const requiredFields = form.querySelectorAll('[required]');

            // Limpa todos os erros antigos
            form.querySelectorAll('.form-group.error').forEach(group => {
                group.classList.remove('error');
                const errorDiv = group.querySelector('.input-error-message');
                if (errorDiv) errorDiv.style.display = 'none';
            });
            
            requiredFields.forEach(field => {
                let fieldValid = true;
                if (field.type === 'radio') {
                    const radioGroup = document.querySelectorAll(`input[name="${field.name}"]`);
                    if (![...radioGroup].some(r => r.checked)) {
                        fieldValid = false;
                        showError(field, 'Por favor, selecione uma opção.');
                    }
                } else if (field.type === 'checkbox') {
                     const checkGroup = document.querySelectorAll(`input[name="${field.name}"]:checked`);
                     if(checkGroup.length === 0){
                        // Apenas um exemplo, não há checkboxes obrigatórios neste form
                     }
                } else {
                     if (!field.value.trim()) {
                         fieldValid = false;
                         showError(field, field.dataset.errorMessage || `O campo ${field.labels[0].textContent.replace('*','').trim()} é obrigatório.`);
                     } else if(field.type === 'email' && !/^\S+@\S+\.\S+$/.test(field.value)) {
                         fieldValid = false;
                         showError(field, 'Por favor, insira um e-mail válido.');
                     }
                }

                if(!fieldValid) isValid = false;
            });
            
            if(!isValid) {
                 const firstErrorField = form.querySelector('.form-group.error');
                 if(firstErrorField) firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            return isValid;
        }

        // Adiciona listeners para validar em tempo real após a primeira tentativa de envio
        form.querySelectorAll('input[required], select[required], textarea[required]').forEach(input => {
            input.addEventListener('input', () => clearError(input));
            input.addEventListener('change', () => clearError(input));
        });

        // --- Lógica de submissão do formulário ---
        form.addEventListener('submit', async function (event) {
            event.preventDefault();

            if (!validateForm()) {
                formStatus.textContent = 'Existem erros no formulário. Por favor, corrija-os.';
                return;
            }

            setLoadingState(true);

            // Coleta dos dados do formulário
            const formData = new FormData(form);
            const payload = {};
            
            // Converte FormData para um objeto JSON, tratando checkboxes
            formData.forEach((value, key) => {
                if (!Reflect.has(payload, key)) {
                    payload[key] = value;
                    return;
                }
                if (!Array.isArray(payload[key])) {
                    payload[key] = [payload[key]];
                }
                payload[key].push(value);
            });
            
            // Converte arrays (de checkboxes) em strings separadas por vírgula
            for (const key in payload) {
                if (Array.isArray(payload[key])) {
                    payload[key] = payload[key].join(', ');
                }
            }
            
            try {
                // Primeira tentativa: Envio normal com CORS
                console.log("Tentando envio para o Apps Script (modo CORS)...");
                const response = await fetch(APP_SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('Sucesso (CORS):', result);
                    handleSuccess();
                } else {
                    // Se o servidor respondeu com um erro (ex: 4xx, 5xx)
                    throw new Error(`Erro do servidor: ${response.statusText}`);
                }

            } catch (error) {
                console.error("Erro na primeira tentativa (CORS):", error);
                
                // Fallback para 'no-cors' se o erro for de rede (típico de bloqueio CORS no navegador)
                if (error instanceof TypeError) {
                     console.log("Falha de CORS detectada. Tentando envio com modo 'no-cors'...");
                     try {
                         await fetch(APP_SCRIPT_URL, {
                             method: 'POST',
                             mode: 'no-cors', // Importante: não podemos ler a resposta aqui
                             headers: { 'Content-Type': 'application/json' },
                             body: JSON.stringify(payload)
                         });
                         console.log("Envio 'no-cors' concluído. Assumindo sucesso.");
                         handleSuccess();
                     } catch (noCorsError) {
                         console.error("Erro fatal mesmo com 'no-cors':", noCorsError);
                         handleError("Não foi possível enviar suas informações. Verifique sua conexão e tente novamente.");
                     }
                } else {
                    // Outros tipos de erro
                    handleError(`Ocorreu um erro: ${error.message}`);
                }
            } finally {
                setLoadingState(false);
            }
        });

        function setLoadingState(isLoading) {
            submitButton.disabled = isLoading;
            if (isLoading) {
                submitButton.classList.add('loading');
                btnText.textContent = 'Enviando...';
                formStatus.textContent = 'Enviando formulário...';
            } else {
                submitButton.classList.remove('loading');
                btnText.textContent = 'Gerar meu Plano Personalizado';
            }
        }

        function handleSuccess() {
            form.reset();
            // Reseta manualmente os campos condicionais e o slider para o estado inicial
            dietaAnteriorContainer.classList.add('hidden');
            tipoExercicioContainer.classList.add('hidden');
            estresseValor.textContent = '2';

            formStatus.textContent = 'Formulário enviado com sucesso!';
            successModal.classList.add('visible');
        }

        function handleError(message) {
            formStatus.textContent = `Erro: ${message}`;
            alert(message); // Um alerta simples para erro
        }

        // Fechar o modal
        closeModalBtn.addEventListener('click', () => successModal.classList.remove('visible'));
        successModal.addEventListener('click', (e) => {
            if (e.target === successModal) {
                successModal.classList.remove('visible');
            }
        });
    });
    </script>
</body>
</html>
